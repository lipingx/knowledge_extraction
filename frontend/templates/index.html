<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Knowledge Extraction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fab fa-youtube"></i>
                    <h1>Knowledge Extraction</h1>
                </div>
                <p class="subtitle">Extract books, people, places, and facts from YouTube videos</p>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navigation">
            <button class="nav-btn active" id="extractNavBtn" data-view="extract">
                <i class="fas fa-magic"></i>
                Extract Knowledge
            </button>
            <button class="nav-btn" id="segmentsNavBtn" data-view="segments">
                <i class="fas fa-list"></i>
                View Segments
            </button>
            <button class="nav-btn" id="statsNavBtn" data-view="stats">
                <i class="fas fa-chart-bar"></i>
                Statistics
            </button>
        </nav>

        <!-- Extract Knowledge View -->
        <div class="view-container" id="extractView">
            <!-- Main Form -->
            <div class="form-section">
            <form id="extractForm" class="extraction-form">
                <div class="input-group">
                    <label for="youtube-url">
                        <i class="fas fa-link"></i>
                        YouTube Video URL
                    </label>
                    <input 
                        type="text" 
                        id="youtube-url" 
                        name="url" 
                        placeholder="https://www.youtube.com/watch?v=..." 
                        required
                    >
                </div>

                <div class="time-inputs">
                    <div class="input-group">
                        <label for="start-time">
                            <i class="fas fa-play"></i>
                            Start Time (optional)
                        </label>
                        <input 
                            type="text" 
                            id="start-time" 
                            name="start_time" 
                            placeholder="1:24:07 or 89"
                        >
                    </div>

                    <div class="input-group">
                        <label for="end-time">
                            <i class="fas fa-stop"></i>
                            End Time (optional)
                        </label>
                        <input 
                            type="text" 
                            id="end-time" 
                            name="end_time" 
                            placeholder="1:26:00 or 150"
                        >
                    </div>

                    <div class="input-group">
                        <label for="duration">
                            <i class="fas fa-clock"></i>
                            Duration in seconds (optional)
                        </label>
                        <input 
                            type="number" 
                            id="duration" 
                            name="duration" 
                            placeholder="60"
                            min="1"
                        >
                    </div>
                </div>

                <button type="submit" class="extract-btn" id="extractBtn">
                    <i class="fas fa-magic"></i>
                    <span>Extract Knowledge</span>
                </button>
            </form>
        </div>

        <!-- Video Preview Section -->
        <div id="videoPreview" class="video-preview-section hidden">
            <div class="preview-header">
                <h3><i class="fas fa-play"></i> Video Preview</h3>
                <div class="preview-controls">
                    <button class="preview-btn active" id="previewEmbedBtn">
                        <i class="fas fa-tv"></i>
                        Embedded
                    </button>
                    <button class="preview-btn" id="previewYoutubeBtn">
                        <i class="fab fa-youtube"></i>
                        YouTube
                    </button>
                </div>
            </div>
            
            <div class="preview-container" id="previewContainer">
                <iframe 
                    id="previewFrame" 
                    class="preview-frame"
                    frameborder="0" 
                    allowfullscreen>
                </iframe>
            </div>
            
            <div class="preview-info" id="previewInfo">
                <div class="video-details">
                    <span class="video-id" id="previewVideoId"></span>
                    <div class="preview-links">
                        <a href="#" id="previewDirectLink" class="preview-link" target="_blank">
                            <i class="fas fa-external-link-alt"></i>
                            Open in YouTube
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading-state hidden">
            <div class="loading-spinner"></div>
            <p>Extracting knowledge from video...</p>
            <small>This may take 30-60 seconds</small>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section hidden">
            <div class="results-header">
                <h2><i class="fas fa-brain"></i> Extracted Knowledge</h2>
                <div class="meta-info" id="metaInfo"></div>
            </div>

            <!-- Video Player Section -->
            <div class="video-section">
                <div class="video-header">
                    <h3><i class="fas fa-play"></i> Video Player</h3>
                    <div class="video-controls">
                        <button class="video-btn active" id="embedBtn">
                            <i class="fas fa-tv"></i>
                            Embed Player
                        </button>
                        <button class="video-btn" id="youtubeBtn">
                            <i class="fab fa-youtube"></i>
                            Open in YouTube
                        </button>
                        <button class="video-btn" id="timestampBtn">
                            <i class="fas fa-clock"></i>
                            Jump to Time
                        </button>
                    </div>
                </div>
                
                <div class="video-container" id="videoContainer">
                    <div class="video-placeholder" id="videoPlaceholder">
                        <i class="fas fa-play-circle"></i>
                        <p>Click "Embed Player" to load video</p>
                    </div>
                    <iframe 
                        id="videoFrame" 
                        class="video-frame hidden"
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                </div>
                
                <div class="video-info" id="videoInfo">
                    <div class="time-display">
                        <span class="time-label">Extracted Segment:</span>
                        <span class="time-range" id="timeRange">--:-- - --:--</span>
                    </div>
                    <div class="video-links">
                        <a href="#" id="directLink" class="link-btn" target="_blank">
                            <i class="fas fa-external-link-alt"></i>
                            Direct YouTube Link
                        </a>
                        <a href="#" id="timestampLink" class="link-btn" target="_blank">
                            <i class="fas fa-clock"></i>
                            Link with Timestamp
                        </a>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <div class="result-card">
                <div class="card-header">
                    <h3><i class="fas fa-file-text"></i> Summary</h3>
                </div>
                <div class="card-content">
                    <p id="summaryContent"></p>
                </div>
            </div>

            <!-- Entities Grid -->
            <div class="entities-grid">
                <!-- Books -->
                <div class="result-card">
                    <div class="card-header">
                        <h3><i class="fas fa-book"></i> Books & Publications</h3>
                        <span class="count" id="booksCount">0</span>
                    </div>
                    <div class="card-content">
                        <ul id="booksList" class="entity-list"></ul>
                    </div>
                </div>

                <!-- People -->
                <div class="result-card">
                    <div class="card-header">
                        <h3><i class="fas fa-users"></i> People</h3>
                        <span class="count" id="peopleCount">0</span>
                    </div>
                    <div class="card-content">
                        <ul id="peopleList" class="entity-list"></ul>
                    </div>
                </div>

                <!-- Places -->
                <div class="result-card">
                    <div class="card-header">
                        <h3><i class="fas fa-map-marker-alt"></i> Places</h3>
                        <span class="count" id="placesCount">0</span>
                    </div>
                    <div class="card-content">
                        <ul id="placesList" class="entity-list"></ul>
                    </div>
                </div>

                <!-- Facts -->
                <div class="result-card">
                    <div class="card-header">
                        <h3><i class="fas fa-lightbulb"></i> Key Facts</h3>
                        <span class="count" id="factsCount">0</span>
                    </div>
                    <div class="card-content">
                        <ul id="factsList" class="entity-list"></ul>
                    </div>
                </div>

                <!-- Topics -->
                <div class="result-card">
                    <div class="card-header">
                        <h3><i class="fas fa-tags"></i> Topics</h3>
                        <span class="count" id="topicsCount">0</span>
                    </div>
                    <div class="card-content">
                        <ul id="topicsList" class="entity-list"></ul>
                    </div>
                </div>
            </div>

            <!-- Transcript -->
            <div class="result-card">
                <div class="card-header">
                    <h3><i class="fas fa-scroll"></i> Full Transcript</h3>
                    <button class="toggle-btn" id="transcriptToggle">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="card-content transcript-content" id="transcriptContent">
                    <p id="transcriptText"></p>
                </div>
            </div>

            <!-- Export Options -->
            <div class="export-section">
                <h3><i class="fas fa-download"></i> Export Results</h3>
                <div class="export-buttons">
                    <button class="export-btn" id="exportJson">
                        <i class="fas fa-code"></i>
                        Download JSON
                    </button>
                    <button class="export-btn" id="exportText">
                        <i class="fas fa-file-alt"></i>
                        Download Text
                    </button>
                </div>
            </div>
        </div>

            <!-- Error Display -->
            <div id="errorSection" class="error-section hidden">
                <div class="error-content">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Error</h3>
                    <p id="errorMessage"></p>
                    <button class="retry-btn" id="retryBtn">Try Again</button>
                </div>
            </div>
        </div>

        <!-- Segments View -->
        <div class="view-container hidden" id="segmentsView">
            <div class="segments-header">
                <h2><i class="fas fa-list"></i> Stored Segments</h2>
                <div class="segments-controls">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="segmentSearch" placeholder="Search segments...">
                    </div>
                    <button class="refresh-btn" id="refreshSegments">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Segments Loading -->
            <div id="segmentsLoading" class="segments-loading hidden">
                <div class="loading-spinner"></div>
                <p>Loading segments...</p>
            </div>

            <!-- Segments List -->
            <div id="segmentsList" class="segments-list">
                <!-- Segments will be populated here -->
            </div>

            <!-- No Segments Message -->
            <div id="noSegments" class="no-segments hidden">
                <i class="fas fa-inbox"></i>
                <h3>No segments found</h3>
                <p>Extract your first knowledge segment to see it here!</p>
            </div>
        </div>

        <!-- Statistics View -->
        <div class="view-container hidden" id="statsView">
            <div class="stats-header">
                <h2><i class="fas fa-chart-bar"></i> Storage Statistics</h2>
            </div>
            
            <div id="statsLoading" class="stats-loading hidden">
                <div class="loading-spinner"></div>
                <p>Loading statistics...</p>
            </div>

            <div id="statsContent" class="stats-content">
                <!-- Statistics will be populated here -->
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Powered by OpenAI GPT-4 and YouTube Transcript API</p>
    </footer>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>